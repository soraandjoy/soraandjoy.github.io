<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sora & Joy</title>
<meta name="description" content="Sora & Joy — Photos and Life Log" />
<style>
  :root{
    --bg:#0b0d10; --card:#12161c; --text:#e8eef7; --muted:#9fb3c8; --accent:#6ee7ff;
    --border:#1f2a37; --glow:#a5f3fc;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,sans-serif}
  a{color:inherit;text-decoration:none}
  header{position:sticky;top:0;z-index:50;backdrop-filter: blur(8px); background:rgba(11,13,16,.7);border-bottom:1px solid var(--border)}
  .wrap{max-width:1100px;margin:0 auto;padding:0 16px}
  .nav{display:flex;align-items:center;justify-content:space-between;height:64px}
  .brand{font-weight:700;letter-spacing:.5px}
  .menu{display:flex;gap:16px;font-weight:600}
  .menu a{padding:8px 10px;border-radius:10px}
  .menu a.active, .menu a:hover{background:#0f141b;border:1px solid var(--border)}
  main{padding:28px 0 72px}
  h1{margin:8px 0 16px;font-size:28px}
  h2{margin:18px 0 12px;font-size:20px;color:var(--muted)}
  .section{display:none;animation:fade .25s ease}
  .section.active{display:block}
  @keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}

  /* PHOTO grid */
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
  .card{position:relative;background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden}
  .thumbwrap{position:relative;aspect-ratio:4/3;overflow:hidden}
  .thumb{width:100%;height:100%;object-fit:cover;display:block;transform:scale(1);transition:transform .5s ease}
  .meta{padding:10px 12px;color:var(--muted);font-size:12px;border-top:1px solid var(--border)}
  .card a.open{position:absolute;inset:0}
  /* Shimmer border on hover */
  .card::before{
    content:""; position:absolute; inset:-2px; border-radius:18px; 
    background: conic-gradient(from 0deg, transparent 0deg, transparent 260deg, var(--glow) 300deg, transparent 360deg);
    filter: blur(6px); opacity:0; transition:opacity .25s ease, transform .25s ease;
    transform: scale(.98);
    pointer-events:none;
  }
  .card:hover::before{opacity:.9; transform:scale(1)}
  .card:hover .thumb{transform:scale(1.03)}

  /* prose (docx → html) */
  .prose{line-height:1.7;color:var(--text);}
  .prose p{margin:.6em 0}
  .prose h1,.prose h2,.prose h3{color:#dbe7f3;margin:1em 0 .5em}
  .prose a{color:var(--accent);text-decoration:underline}
  .muted{color:var(--muted)}
  .pill{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);background:#0f141b;border-radius:999px;padding:6px 10px;font-size:12px;color:var(--muted)}
  .footer{margin-top:36px;color:var(--muted);border-top:1px solid var(--border);padding-top:16px}
  .notice{font-size:12px;color:var(--muted)}
  .center{display:flex;align-items:center;justify-content:center;min-height:120px}
  .spinner{width:28px;height:28px;border:3px solid #1f2a37;border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  @media (max-width:560px){ .menu{gap:8px} .menu a{padding:6px 8px} }
</style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand">Sora & Joy</div>
      <nav class="menu" id="menu">
        <a href="#home"   data-link>HOME</a>
        <a href="#mylife" data-link>MY LIFE</a>
        <a href="#photo"  data-link>PHOTO</a>
        <a href="#log"    data-link>LEAVE LOG</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <!-- HOME -->
    <section id="home" class="section">
      <h1>Welcome</h1>
      <div id="homeContent" class="prose"><div class="center"><div class="spinner"></div></div></div>
    </section>

    <!-- MY LIFE -->
    <section id="mylife" class="section">
      <h1>My Life</h1>
      <div id="mylifeContent" class="prose"><div class="center"><div class="spinner"></div></div></div>
    </section>

    <!-- PHOTO -->
    <section id="photo" class="section">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <h1>Photos</h1>
        <span class="pill"><span>최신 업로드가 위에 표시됩니다</span></span>
      </div>
      <div id="photoGrid" class="grid" style="margin-top:12px">
        <div class="center" style="grid-column:1/-1"><div class="spinner"></div></div>
      </div>
      <div class="footer"><span class="muted" id="updatedAt"></span></div>
    </section>

    <!-- LEAVE LOG (giscus) -->
    <section id="log" class="section">
      <h1>Leave a Log</h1>
      <!-- giscus: 아래 값들을 본인 설정으로 교체 -->
      <script src="https://giscus.app/client.js"
              data-repo="soraandjoy/soraandjoy.github.io"
              data-repo-id=""
              data-category="General"
              data-category-id=""
              data-mapping="pathname"
              data-strict="0"
              data-reactions-enabled="1"
              data-emit-metadata="0"
              data-input-position="bottom"
              data-theme="dark"
              data-lang="ko"
              crossorigin="anonymous"
              async>
      </script>
      <noscript class="muted">댓글을 보려면 JavaScript가 필요합니다.</noscript>
    </section>
  </main>

  <!-- mammoth: 브라우저에서 docx → html 변환 -->
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script>
  // ====== CONFIG (Option A) ======
  const OWNER  = "soraandjoy";                 // 깃허브 아이디
  const REPO   = "soraandjoy.github.io";       // 저장소 이름
  const BRANCH = "main";                       // 브랜치
  const PATHS = {
    photos : "photos",
    homeDoc: "content/home.docx",
    lifeDoc: "content/mylife.docx",
  };

  // raw.githubusercontent 전용 URL
  const rawUrl = (path) => `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${path}`;

  // GitHub Contents API (디렉토리 목록/파일 메타 조회)
  const ghContents = (path) =>
    `https://api.github.com/repos/${OWNER}/${REPO}/contents/${encodeURIComponent(path)}?ref=${BRANCH}`;

  // ====== 라우터 ======
  const sections = ["home","mylife","photo","log"];
  function setActive(route){
    sections.forEach(id=>{
      document.getElementById(id).classList.toggle("active", id===route);
    });
    document.querySelectorAll('[data-link]').forEach(a=>{
      a.classList.toggle("active", a.getAttribute("href")==="#"+route);
    });
  }
  window.addEventListener("hashchange", boot);
  function boot(){
    const hash = (location.hash || "#home").replace("#","");
    const route = sections.includes(hash)? hash : "home";
    setActive(route);
    if(route==="photo")  loadPhotos();
    if(route==="home")   loadDocx(PATHS.homeDoc, "homeContent");
    if(route==="mylife") loadDocx(PATHS.lifeDoc, "mylifeContent");
  }

  // ====== DOCX 로더 (raw 사용) ======
  async function loadDocx(path, targetId){
    const el = document.getElementById(targetId);
    try{
      const res = await fetch(rawUrl(path), {cache:"no-store"});
      if(!res.ok) throw new Error("파일을 찾지 못했습니다");
      const buf = await res.arrayBuffer();
      const result = await window.mammoth.convertToHtml({arrayBuffer: buf});
      el.innerHTML = result.value || "<p class='muted'>문서 내용이 비어 있습니다.</p>";
    }catch(e){
      el.innerHTML = `<p class="muted"><code>${path}</code>를 불러오지 못했습니다. (DOCX 형식/경로/공개 여부/Git LFS 여부 확인)<br/>오류: ${e.message}</p>`;
    }
  }

  // ====== PHOTOS 로더 (목록: API, 이미지: raw) ======
  async function loadPhotos(){
    const grid = document.getElementById("photoGrid");
    try{
      const res = await fetch(ghContents(PATHS.photos), {cache:"no-store"});
      if(!res.ok) throw new Error("photos 폴더를 찾지 못했습니다");
      /** @type {{name:string, path:string, type:string}[]} */
      const items = await res.json();

      // 이미지 확장자 필터
      const exts = [".jpg",".jpeg",".png",".gif",".webp",".bmp",".avif"];
      const photos = items
        .filter(x => x.type==="file" && exts.some(ext=> x.name.toLowerCase().endsWith(ext)))
        // 파일명 기준 내림차순 (YYYY-MM-DD_HHMMSS_ 프리픽스 권장)
        .sort((a,b)=> b.name.localeCompare(a.name));

      if(photos.length===0){
        grid.innerHTML = `<div class="center" style="grid-column:1/-1"><p class="muted"><code>/${PATHS.photos}</code>에 이미지가 없습니다.</p></div>`;
        document.getElementById("updatedAt").textContent = "";
        return;
      }

      // 카드 렌더링
      grid.innerHTML = "";
      const maxW = 1024, maxH = 768; // 그리드 표시 목표 사이즈(원본은 새창)
      photos.forEach(p=>{
        const raw = rawUrl(`${PATHS.photos}/${p.name}`); // 새창에서 원본 열기 (raw)
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <a class="open" href="${raw}" target="_blank" rel="noopener" title="원본 열기 (새 창)"></a>
          <div class="thumbwrap">
            <img class="thumb" src="${raw}" alt="${p.name}" loading="lazy"
                 style="max-width:${maxW}px; max-height:${maxH}px;" />
          </div>
          <div class="meta">${p.name}</div>
        `;
        grid.appendChild(card);
      });

      document.getElementById("updatedAt").textContent =
        "Updated: " + new Date().toLocaleString();

    }catch(e){
      grid.innerHTML = `<div class="center" style="grid-column:1/-1"><p class="muted">사진을 불러오지 못했습니다. ${e.message}</p></div>`;
      document.getElementById("updatedAt").textContent = "";
    }
  }

  // 초기 진입
  boot();
  </script>
</body>
</html>
